<div class="container mx-auto p-6 max-w-6xl">

  <!-- PROGRESS STEPPER -->
  <div class="mb-10">
    <ol class="flex items-center justify-between w-full text-sm font-medium">

      <li class="flex items-center gap-3" [ngClass]="step >= 1 ? 'text-blue-600' : 'text-gray-400'">
        <span class="flex items-center justify-center w-10 h-10 rounded-full font-bold"
              [ngClass]="step >= 1 ? 'bg-blue-100 text-blue-700' : 'bg-gray-200 text-gray-500'">1</span>
        <span class="hidden md:block font-semibold">Guest House Info</span>
      </li>

      <div class="flex-1 border-t-2 mx-3" 
           [ngClass]="step >= 2 ? 'border-blue-400' : 'border-gray-300'"></div>

      <li class="flex items-center gap-3" [ngClass]="step >= 2 ? 'text-blue-600' : 'text-gray-400'">
        <span class="flex items-center justify-center w-10 h-10 rounded-full font-bold"
              [ngClass]="step >= 2 ? 'bg-blue-100 text-blue-700' : 'bg-gray-200 text-gray-500'">2</span>
        <span class="hidden md:block font-semibold">Room Selection</span>
      </li>

      <div class="flex-1 border-t-2 mx-3"
           [ngClass]="step >= 3 ? 'border-blue-400' : 'border-gray-300'"></div>

      <li class="flex items-center gap-3" [ngClass]="step >= 3 ? 'text-blue-600' : 'text-gray-400'">
        <span class="flex items-center justify-center w-10 h-10 rounded-full font-bold"
              [ngClass]="step >= 3 ? 'bg-blue-100 text-blue-700' : 'bg-gray-200 text-gray-500'">3</span>
        <span class="hidden md:block font-semibold">Date & Bed</span>
      </li>

    </ol>
  </div>

  <!-- STEP 1 -->
  <div *ngIf="step === 1">
    <h2 class="text-3xl font-bold text-gray-900 mb-6">Select a Guest House</h2>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <div *ngFor="let gh of guesthouses"
           (click)="selectGuesthouse(gh)"
           class="bg-white rounded-xl shadow-md hover:shadow-xl cursor-pointer transition transform hover:-translate-y-1 border">

        <img [src]="gh.imageUrl || 'https://via.placeholder.com/400x220?text=No+Image'"
             alt="{{ gh.name }}"
             class="w-full h-48 object-cover rounded-t-xl">

        <div class="p-5">
          <h3 class="text-xl font-semibold text-gray-900">{{ gh.name }}</h3>
          <p class="text-gray-600 mt-1">
            <i class="fas fa-map-marker-alt text-blue-500 mr-2"></i>{{ gh.location }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- STEP 2 -->
  <div *ngIf="step === 2">
    <button (click)="goBack(1)" class="mb-4 text-blue-600 hover:underline">&larr; Back</button>

    <h2 class="text-3xl font-bold text-gray-900 mb-6">
      Select a Room in <span class="text-blue-600">{{ selectedGuesthouse?.name }}</span>
    </h2>

    <div *ngIf="filteredRooms.length === 0"
         class="p-4 bg-yellow-100 border border-yellow-300 text-yellow-800 rounded">
      No rooms available for your gender in this guest house.
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
      <div *ngFor="let room of filteredRooms"
           (click)="selectRoom(room)"
           class="p-5 bg-white rounded-xl border shadow-sm hover:shadow-lg cursor-pointer transition">

        <div class="flex justify-between items-center">
          <h3 class="text-xl font-semibold">{{ room.roomName }}</h3>
          <span class="text-sm text-gray-500 px-3 py-1 bg-gray-100 rounded-full">
            {{ room.genderAllowed }}
          </span>
        </div>

      </div>
    </div>
  </div>

  <!-- STEP 3 -->
  <div *ngIf="step === 3">
    <button (click)="goBack(2)" class="mb-4 text-blue-600 hover:underline">&larr; Back</button>

    <h2 class="text-3xl font-bold text-gray-900 mb-6">
      Check Availability for <span class="text-blue-600">{{ selectedRoom?.roomName }}</span>
    </h2>

    <!-- DATE FORM -->
    <form [formGroup]="dateForm" (ngSubmit)="checkAvailability()" 
          class="bg-white p-6 rounded-xl shadow border">

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

        <div>
          <label class="font-semibold text-gray-800">From</label>
          <input type="date" formControlName="dateFrom" [min]="minDate"
                 class="w-full border rounded-lg px-3 py-2 mt-1">
        </div>

        <div>
          <label class="font-semibold text-gray-800">To</label>
          <input type="date" formControlName="dateTo" 
                 [min]="dateForm.get('dateFrom')?.value || minDate"
                 class="w-full border rounded-lg px-3 py-2 mt-1">
        </div>

        <div class="flex items-end">
          <button type="submit"
                  [disabled]="dateForm.invalid"
                  class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg disabled:bg-gray-400">
            Check Availability
          </button>
        </div>

      </div>

      <div *ngIf="dateForm.controls['dateTo'].dirty && dateForm.hasError('invalidRange')"
           class="text-red-500 text-sm mt-3">
        'To' date must be at least one day after 'From' date.
      </div>
    </form>

    <!-- AVAILABLE BEDS -->
    <div *ngIf="availableBeds.length > 0" class="mt-8">
      <h3 class="text-xl font-semibold mb-4">Available Beds</h3>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div *ngFor="let bed of availableBeds"
             class="p-4 bg-green-100 border border-green-300 rounded-xl flex justify-between items-center">

          <span class="text-lg font-medium text-green-800">
            Bed {{ bed.bedNumber }}
          </span>

          <button (click)="submitBooking(bed.bedId)"
                  [disabled]="loadingBedId !== null"
                  class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-lg">

            <ng-container *ngIf="loadingBedId === bed.bedId; else normalBtn">
              <svg class="animate-spin h-5 w-5 inline-block mr-2"
                   xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                        stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                      d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
              </svg>
              Processing...
            </ng-container>

            <ng-template #normalBtn>
              Book This Bed
            </ng-template>

          </button>

        </div>
      </div>
    </div>

    <div *ngIf="availabilityMessage"
         class="mt-6 p-4 bg-yellow-100 border border-yellow-300 text-yellow-800 rounded-xl">
      {{ availabilityMessage }}
    </div>

  </div>
</div>
