<div class="container mx-auto p-6 max-w-5xl">

  <div class="mb-8">
    <ol class="flex items-center w-full text-sm font-medium text-center text-gray-500">
      <li class="flex md:w-full items-center" 
          [ngClass]="{'text-blue-600': step >= 1}">
        <span class="flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-full shrink-0 mr-2"
              [ngClass]="step >= 1 ? 'bg-blue-100' : 'bg-gray-100'">
          1
        </span>
        Guest House
        <span class="hidden sm:inline-flex sm:ml-2">Info</span>
        <svg *ngIf="step > 1" class="w-3 h-3 ml-2 sm:ml-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path></svg>
      </li>
      <li class="flex md:w-full items-center"
          [ngClass]="{'text-blue-600': step >= 2}">
        <span class="flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-full shrink-0 ml-2"
              [ngClass]="step >= 2 ? 'bg-blue-100' : 'bg-gray-100'">
          2
        </span>
        Room
        <span class="hidden sm:inline-flex sm:ml-2">Selection</span>
        <svg *ngIf="step > 2" class="w-3 h-3 ml-2 sm:ml-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path></svg>
      </li>
      <li class="flex items-center"
          [ngClass]="{'text-blue-600': step >= 3}">
        <span class="flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-full shrink-0 ml-2"
              [ngClass]="step >= 3 ? 'bg-blue-100' : 'bg-gray-100'">
          3
        </span>
        Date & Bed
      </li>
    </ol>
  </div>
  <div *ngIf="step === 1">
    <h2 class="text-3xl font-extrabold text-gray-800 mb-6">Step 1: Select a Guest House</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <div *ngFor="let gh of guesthouses" 
           (click)="selectGuesthouse(gh)"
           class="bg-white rounded-lg shadow-xl overflow-hidden transform transition duration-300 ease-in-out hover:scale-105 hover:shadow-2xl border border-gray-200 cursor-pointer">
        <img [src]="gh.imageUrl || 'https://via.placeholder.com/400x220?text=No+Image+Available'" 
             alt="{{ gh.name }}" 
             class="w-full h-48 object-cover object-center">
        <div class="p-6">
          <h3 class="text-2xl font-bold text-gray-900 mb-2">{{ gh.name }}</h3>
          <p class="text-gray-700 text-lg"><i class="fas fa-map-marker-alt mr-2 text-blue-500"></i>{{ gh.location }}</p>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="step === 2">
    <button (click)="goBack(1)" class="mb-4 text-blue-600 hover:underline">&larr; Back to Guest Houses</button>
    <h2 class="text-3xl font-extrabold text-gray-800 mb-6">Step 2: Select a Room in <span class="text-blue-600">{{ selectedGuesthouse?.name }}</span></h2>
    
    <div *ngIf="filteredRooms.length === 0" class="p-4 bg-yellow-100 border border-yellow-300 text-yellow-800 rounded">
      No rooms available for your gender in this guest house.
    </div>

    <div class="flex flex-col space-y-3">
      <div *ngFor="let room of filteredRooms" 
           (click)="selectRoom(room)"
           class="p-6 bg-white rounded-lg shadow-lg border border-gray-200 cursor-pointer hover:bg-gray-50 flex justify-between items-center">
        <h3 class="text-xl font-semibold text-gray-800">{{ room.roomName }}</h3>
        <span class="text-gray-500">Gender: {{ room.genderAllowed }}</span>
      </div>
    </div>
  </div>

  <div *ngIf="step === 3">
    <button (click)="goBack(2)" class="mb-4 text-blue-600 hover:underline">&larr; Back to Rooms</button>
    <h2 class="text-3xl font-extrabold text-gray-800 mb-6">Step 3: Check Availability for <span class="text-blue-600">{{ selectedRoom?.roomName }}</span></h2>
    
   <form [formGroup]="dateForm" (ngSubmit)="checkAvailability()" class="bg-white p-6 rounded shadow-md border">
    
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
        
        <div>
          <label for="dateFrom" class="block text-gray-700 font-bold mb-2">From</label>
        <input type="date" id="dateFrom" formControlName="dateFrom" [min]="minDate" class="w-full px-3 py-2 border rounded">
          <!-- <p *ngIf="dateForm.get('dateFrom')?.value" class="text-sm text-gray-600 mt-1">
            Selected: <b>{{ datePipe.transform(dateForm.get('dateFrom')?.value, 'dd/MM/yyyy') }}</b>
          </p> -->
        </div>
        <div>
          <label for="dateTo" class="block text-gray-700 font-bold mb-2">To</label>
          <input type="date" id="dateTo" formControlName="dateTo" [min]="dateForm.get('dateFrom')?.value || minDate" class="w-full px-3 py-2 border rounded">
          <!-- <p *ngIf="dateForm.get('dateTo')?.value" class="text-sm text-gray-600 mt-1">
            Selected: <b>{{ datePipe.transform(dateForm.get('dateTo')?.value, 'dd/MM/yyyy') }}</b>
          </p> -->
        </div>
        <div>
          <button type="submit" [disabled]="dateForm.invalid" class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:bg-gray-400">
            Check Availability
          </button>
        </div>
      </div>
      
      <div *ngIf="dateForm.controls['dateTo'].dirty && dateForm.hasError('invalidRange')" class="text-red-500 text-sm mt-2">
        'To' date must be at least one day after 'From' date.
      </div>
    </form>
    <div *ngIf="availableBeds.length > 0" class="mt-6">
      <h3 class="text-xl font-semibold text-gray-700 mb-3">Available Beds:</h3>
      <div class="flex flex-col space-y-3">
        <div *ngFor="let bed of availableBeds" 
             class="p-4 bg-green-100 border border-green-300 rounded-lg flex justify-between items-center">
          <span class="text-lg font-medium text-green-800">Bed {{ bed.bedNumber }}</span>
          <button (click)="submitBooking(bed.bedId)" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
            Book This Bed
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="availabilityMessage" class="mt-6 p-4 bg-yellow-100 border border-yellow-300 text-yellow-800 rounded-lg">
      {{ availabilityMessage }}
    </div>
  </div>

</div>
